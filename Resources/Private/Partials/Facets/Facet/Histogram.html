{namespace s=Tx_Find_ViewHelpers}
{namespace t3jquery=Tx_T3jquery_ViewHelpers}
<t3jquery:addJQueryAndScript jsfile="EXT:find/Resources/Public/JavaScript/flot/jquery.flot.js"/>
<t3jquery:addJQueryAndScript jsfile="EXT:find/Resources/Public/JavaScript/flot/jquery.flot.selection.js"/>
<div class="facetHistogram-container">
	<f:if condition="{s:facetIsActive(facetID:facetInfo.id, activeFacets:activeFacets)}">
		<f:for each="{s:valueForKey(array:activeFacets, key:facetInfo.id)}" as="termInfo" key="term">
			<f:alias map="{years:\"{s:regexp(match:'/RANGE ([0-9]*) TO ([0-9]*)/', replace:'\1-\2', string:term)}\"}">
				<span class="facetActive">
					<f:link.action
						addQueryString="TRUE"
						argumentsToBeExcludedFromQueryString="{s:facetLinkArguments(facetID:facetInfo.id, activeFacets:activeFacets, mode:'remove')}"
						section="{settings.jumpToID}"
						noCacheHash="1"
						class="icon-cancel facetRemove internal"
						title="{f:translate(key:'remove filter %s', arguments:{0:years})}"><span class="facetName">{years}</span></f:link.action>
				</span>
			</f:alias>
		</f:for>
	</f:if>
	<f:alias map="{
		addArguments:'{s:facetLinkArguments(facetID:facetInfo.id, facetTerm:\"%%%%\", mode:\"add\", activeFacets:activeFacets)}',
		removeArguments:'{f:if(
			condition:\"{s:valueForKey(array:arguments.facet, key:facetInfo.id)}\",
			then:\"{s:facetLinkArguments(facetID:facetInfo.id, mode:\'remove\', activeFacets:activeFacets)}\",
			else:\"{0:\'tx_find_find[page]\'}\"
		)}'
	}">
		<f:link.action
			addQueryString="TRUE"
			arguments="{addArguments}"
			argumentsToBeExcludedFromQueryString="{removeArguments}"
			section="{settings.jumpToID}"
			noCacheHash="1"
			class="link-template hidden internal"
		/>
		<div class="histogram" id="c-{uid}-histogram-{facetInfo.id}">
			<script type="text/javascript">
			(function () {
				var histogramConfiguration = {
					'facetID': <s:json data="{facetInfo.id}"/>,
					'barWidth': {f:if(condition:facetInfo.barWidth, then:facetInfo.barWidth else:1)},
					'activeFacets': [],
				}
				<f:for each="{s:valueForKey(array:activeFacets, key:facetInfo.id)}" as="termInfo" key="term">
					histogramConfiguration.activeFacets.push({s:json(data:term)});
				</f:for>
				var facetData = <s:json data="{facetData.values}"/>;

				tx_find.createHistogramForTermsInContainer(facetData, document.getElementById('c-{uid}-histogram-{facetInfo.id}'), histogramConfiguration);
			})();
			</script>
		</div>
	</f:alias>
</div>