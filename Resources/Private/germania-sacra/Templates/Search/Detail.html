{namespace s=Tx_SolrFrontend_ViewHelpers}

<article>
	<h1>{document.kloster}</h1>

	<aside>
		<h2>Karte</h2>
		<div id="c-{document.id}-map" class="map"></div>
		<script type="text/javascript">
			function mapsReady () {
				var mapOptions = {
					'mapTypeId': google.maps.MapTypeId.ROADMAP,
				};

				var mapContainer = document.getElementById('c-{document.id}-map');
				var map = new google.maps.Map(mapContainer, mapOptions);
				var containingBounds = new google.maps.LatLngBounds();
				var point;
				var title;
				var institutionengenau = false;
				<f:for each="{document.koordinaten}" as="koordinaten" key="index">
				point = new google.maps.LatLng({koordinaten});
				title = {s:valueForKey(array:document.ort, key:index, format:"json")};
				new google.maps.Marker({
					'map': map,
					'position': point,
					'title': title
				});
				containingBounds.extend(point);
				institutionengenau |= {s:valueForKey(array:document.koordinaten_institutionengenau, key:index, format:"json")};
				</f:for>
				var NE = containingBounds.getNorthEast();
				var SW = containingBounds.getSouthWest();
				var center = containingBounds.getCenter();
				var width = Math.abs(NE.lng() - SW.lng());
				var minimumWidth = 0.01 * (institutionengenau ? 1 : 10);
				if (width < minimumWidth) {
					containingBounds = new google.maps.LatLngBounds(
						new google.maps.LatLng(SW.lat(), center.lng() - minimumWidth/2),
						new google.maps.LatLng(NE.lat(), center.lng() + minimumWidth/2)
					);
				}
				map.fitBounds(containingBounds);
				console.log(map.getZoom());
			}

			var loadScript = function () {
				var script = document.createElement('script');
				script.type = 'text/javascript';
				script.src = 'https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&callback=mapsReady';
				document.body.appendChild(script);
			}

			jQuery(loadScript);
		</script>

	</aside>

	<section class="patrozinium">
		<h2>Patrozinium</h2>
		<p>
			{document.patrozinium}
		</p>
	</section>

	<section class="lage">
		<h2>Lage</h2>
		<ol>
			<f:for each="{document.ort}" as="ort" key="index">
				<li>
					<p>
						<span class="zeitraum">
							<s:valueForKey array="{document.standort_von_verbal}" key="{index}"/>
							–
							<s:valueForKey array="{document.standort_bis_verbal}" key="{index}"/>
						</span>
						<span class="ort">{ort}</span>,
						<f:if condition="{s:valueForKey(array:document.bemerkung_standort, key:index)}">
							<span class="bemerkung">
								<s:valueForKey array="{document.bemerkung_standort}" key="{index}"/>,
							</span>
						</f:if>
						<f:if condition="{s:valueForKey(array:document.wuestung, key:index)}">
							<span class="wuestung">Wüstung</span>,
						</f:if>
						<span class="land">
							<s:valueForKey array="{document.land}" key="{index}"/>
						</span>
					</p>
				</li>
			</f:for>
		</ol>
		<f:if condition="{f:count(subject:document.bistum) > 0}">
			<p class="bistum">
				<f:if condition="{document.ist_erzbistum.0}">
					<f:then>Erzistum</f:then>
					<f:else>Bistum</f:else>
				</f:if>
				{document.bistum.0}
				
				<f:for each="{document.ort}" as="ort" key="index">
					<f:if condition="{0: ort} != {0: s:valueForKey(array:'{document.ort}', key:'{index}')}">
						<f:then>
							<f:if condition="{key} > 0">
								<f:then>
									auch: {s:valueForKey(array:document.ort, key:index)}
								</f:then>
							</f:if>				
						</f:then>
					</f:if>
				</f:for>
			</p>
		</f:if>
	</section>


	<section class="orden">
		<h2>Orden</h2>
		<ol>
			<f:for each="{document.orden}" as="orden" key="index">
				<li>
					<p>
						<span class="orden">{orden}</span>
						<span class="zeitraum">
							<s:valueForKey array="{document.orden_von_verbal}" key="{index}"/>
							–
							<s:valueForKey array="{document.orden_bis_verbal}" key="{index}"/>
						</span>
					</p>
				</li>
			</f:for>
		</ol>
	</section>
	<f:debug>{_all}</f:debug>

	<f:if condition="{document.bemerkung_kloster.0}">
		<section class="bemerkungen">
			<h2>Bemerkung<h2>
			<p>{document.bemerkung_kloster.0}</p>
		</section>
	</f:if>

	<f:if condition="{document.band_nummer}">
		<section class="germania-sacra">
			<h2>Germania Sacra</h2>
			<p>
				<f:if condition="{document.band_url}">
					<f:then>
						<f:link.external uri="{document.band_url.0}">
							<span class="band-nummer">{document.band_nummer.0}</span>
							<span class="band-titel">{document.band_titel.0}</span>
						</f:link.external>
					</f:then>
					<f:else>
						<span class="band-nummer">{document.band_nummer.0}</span>
						<span class="band-titel">{document.band_titel.0}</span>
					</f:else>
				</f:if>
			</p>
		</section>
	</f:if>


	<f:if condition="{document.literatur}">
		<section class="literatur">
			<h2>Literatur</h2>
			<ul>
				<f:for each="{document.literatur}" as="literatur" key="index">
					<li id="literatur-{s:valueForKey(array:document.literatur-id, key:index)}">
						{literatur}
					</li>
				</f:for>
			</ul>
		</section>
	</f:if>

	<section class="links">
		<h2>Permalink</h2>
		<p>
			<f:link.external uri="http://kloester.germania-sacra.de/gsn/{document.sql_uid}">
				http://kloester.germania-sacra.de/gsn/{document.sql_uid}
			</f:link.external>
		</p>

		<f:if condition="document.gnd">
			<h2>Links</h2>
			<ul>
				<f:for each="{document.gnd}" as="gnd">
					<f:link.external uri="http://kloester.germania-sacra.de/gsn/{document.sql_uid}">
					http://kloester.germania-sacra.de/gsn/{document.sql_uid}
			</f:link.external>
				</f:for>
			</ul>
		</f:if>
	</section>

</article>

